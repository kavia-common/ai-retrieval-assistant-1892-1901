<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ai-rag-lite Browser Demo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 20px; }
      .card { max-width: 800px; margin: 0 auto; border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; box-shadow: 0 2px 4px rgba(0,0,0,0.04); }
      textarea, input { width: 100%; box-sizing: border-box; padding: 8px; margin: 6px 0; border-radius: 8px; border: 1px solid #e5e7eb; }
      button { padding: 8px 12px; border-radius: 8px; background: #2563EB; color: white; border: none; cursor: pointer;}
      button:disabled { background: #93c5fd; cursor: not-allowed; }
      .row { display: flex; gap: 8px; }
    </style>
  </head>
  <body>
    <div class="card">
      <h2>ai-rag-lite Browser Demo</h2>
      <p>This demo uses CustomEmbeddings and an in-memory store.</p>

      <label>Document Text</label>
      <textarea id="docText" rows="5">The Eiffel Tower is located in Paris, France.</textarea>
      <button id="ingestBtn">Ingest</button>

      <label>Question</label>
      <input id="question" value="Where is the Eiffel Tower?" />
      <button id="askBtn" disabled>Ask</button>

      <h3>Answer</h3>
      <pre id="answer"></pre>
    </div>

    <!-- Build instructions:
         1) Run `npm run build` in ai-rag-lite to produce dist/.
         2) Use a bundler to expose UMD or ESM in browser (e.g., simple dev server that supports ES modules).
         3) For this demo, we import from relative ES module files in dist/.
    -->
    <script type="module">
      import {
        LiteRAG,
        MemoryVectorStore,
        CustomEmbeddings,
        CustomLLM
      } from "../dist/index.js";

      const toyEmbedder = (texts) => {
        const dim = 64;
        const toVec = (t) => {
          const v = new Array(dim).fill(0);
          for (let i = 0; i < t.length; i++) {
            v[t.charCodeAt(i) % dim] += 1;
          }
          const norm = Math.sqrt(v.reduce((s, x) => s + x * x, 0)) || 1;
          return v.map((x) => x / norm);
        };
        return Promise.resolve(texts.map(toVec));
      };

      const rag = new LiteRAG({
        embedder: new CustomEmbeddings(toyEmbedder),
        store: new MemoryVectorStore(),
        llm: new CustomLLM(async (prompt) => "Demo LLM: " + prompt.slice(0, 100) + "..."),
      });

      const docText = document.getElementById("docText");
      const ingestBtn = document.getElementById("ingestBtn");
      const question = document.getElementById("question");
      const askBtn = document.getElementById("askBtn");
      const answer = document.getElementById("answer");

      ingestBtn.onclick = async () => {
        ingestBtn.disabled = true;
        await rag.ingest({ id: "browser-doc", text: docText.value });
        askBtn.disabled = false;
        ingestBtn.disabled = false;
      };

      askBtn.onclick = async () => {
        askBtn.disabled = true;
        const res = await rag.query(question.value);
        answer.textContent = res;
        askBtn.disabled = false;
      };
    </script>
  </body>
</html>
