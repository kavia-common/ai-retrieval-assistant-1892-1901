{"is_source_file": true, "format": "TypeScript", "description": "This file implements a lightweight approximate nearest neighbor search using a simple multi-start greedy algorithm and a synthetic neighbor graph for large datasets. It defines the SimpleHNSWIndex class with methods to build the index and perform queries based on cosine similarity.", "external_files": ["./cosine"], "external_methods": ["rankByCosine"], "published": ["SimpleHNSWIndex"], "classes": [{"name": "SimpleHNSWIndex", "description": "A class for approximate nearest neighbor search using a synthetic neighbor graph and greedy search strategies."}], "methods": [{"name": "constructor(maxNeighbors = 8) { constructor", "description": "Initializes the index with a maximum number of neighbors per node, defaulting to 8.", "scope": "SimpleHNSWIndex", "scopeKind": "class"}, {"name": "build(embeddings: number[][]) { build", "description": "Constructs the neighbor graph from provided embeddings, creating random neighbors in a deterministic manner.", "scope": "SimpleHNSWIndex", "scopeKind": "class"}, {"name": "query(vector: number[], topK: number): Array<{ index: number; score: number }> { query", "description": "Performs a cosine similarity search for the top K closest items to a given vector using a multi-start greedy approach.", "scope": "SimpleHNSWIndex", "scopeKind": "class"}, {"name": "const starts = Math.min(5, Math.max(1, Math.floor(n \\/ 200))); Math", "scope": "SimpleHNSWIndex", "scopeKind": "class", "description": "unavailable"}, {"name": "function pseudoRandom(seed: number) { pseudoRandom", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["rankByCosine"], "search-terms": ["HNSW", "approximate search", "cosine similarity", "synthetic neighbor graph", "multi-start greedy search"], "state": 2, "file_id": 16, "knowledge_revision": 33, "git_revision": "", "ctags": [{"_type": "tag", "name": "Math", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^    const starts = Math.min(5, Math.max(1, Math.floor(n \\/ 200)));$/", "language": "TypeScript", "kind": "method", "scope": "SimpleHNSWIndex", "scopeKind": "class"}, {"_type": "tag", "name": "Node", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^type Node = {$/", "language": "TypeScript", "kind": "alias"}, {"_type": "tag", "name": "SimpleHNSWIndex", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^export class SimpleHNSWIndex {$/", "language": "TypeScript", "kind": "class"}, {"_type": "tag", "name": "best", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^        let best = { idx: current, score: currentScore };$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "build", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^  build(embeddings: number[][]) {$/", "language": "TypeScript", "kind": "method", "scope": "SimpleHNSWIndex", "scopeKind": "class"}, {"_type": "tag", "name": "built", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^  private built = false;$/", "language": "TypeScript", "kind": "property", "scope": "SimpleHNSWIndex", "scopeKind": "class"}, {"_type": "tag", "name": "candidate", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^        const candidate = Math.floor(rnd() * n);$/", "language": "TypeScript", "kind": "constant", "scope": "SimpleHNSWIndex.build", "scopeKind": "method"}, {"_type": "tag", "name": "constructor", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^  constructor(maxNeighbors = 8) {$/", "language": "TypeScript", "kind": "method", "scope": "SimpleHNSWIndex", "scopeKind": "class"}, {"_type": "tag", "name": "cosine", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^    const cosine = (a: number[], b: number[]) => {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "current", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^        for (const nb of this.nodes[current].neighbors) {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "current", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^      let current = Math.floor(rand() * n);$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "currentScore", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^        const currentScore =$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "deg", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^      const deg = Math.min(this.maxNeighbors, Math.max(2, Math.floor(rnd() * this.maxNeighbors) /", "language": "TypeScript", "kind": "constant", "scope": "SimpleHNSWIndex.build", "scopeKind": "method"}, {"_type": "tag", "name": "dims", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^  private dims = 0;$/", "language": "TypeScript", "kind": "property", "scope": "SimpleHNSWIndex", "scopeKind": "class"}, {"_type": "tag", "name": "embeddings", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^  private embeddings: number[][] = [];$/", "language": "TypeScript", "kind": "property", "scope": "SimpleHNSWIndex", "scopeKind": "class"}, {"_type": "tag", "name": "improved", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^      let improved = true;$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "maxNeighbors", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^  private maxNeighbors: number;$/", "language": "TypeScript", "kind": "property", "scope": "SimpleHNSWIndex", "scopeKind": "class"}, {"_type": "tag", "name": "n", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^    const n = embeddings.length;$/", "language": "TypeScript", "kind": "constant", "scope": "SimpleHNSWIndex.build", "scopeKind": "method"}, {"_type": "tag", "name": "n", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^    const n = this.embeddings.length;$/", "language": "TypeScript", "kind": "constant", "scope": "SimpleHNSWIndex.query", "scopeKind": "method"}, {"_type": "tag", "name": "nb", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^          const sc = scores[nb] ?? (scores[nb] = cosine(this.embeddings[nb], vector));$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "nb", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^        for (const nb of this.nodes[current].neighbors) {$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "neigh", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^      const neigh = new Set<number>();$/", "language": "TypeScript", "kind": "constant", "scope": "SimpleHNSWIndex.build", "scopeKind": "method"}, {"_type": "tag", "name": "nodes", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^  private nodes: Node[] = [];$/", "language": "TypeScript", "kind": "property", "scope": "SimpleHNSWIndex", "scopeKind": "class"}, {"_type": "tag", "name": "pseudoRandom", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^function pseudoRandom(seed: number) {$/", "language": "TypeScript", "kind": "function"}, {"_type": "tag", "name": "query", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^  query(vector: number[], topK: number): Array<{ index: number; score: number }> {$/", "language": "TypeScript", "kind": "method", "scope": "SimpleHNSWIndex", "scopeKind": "class"}, {"_type": "tag", "name": "rand", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^    const rand = pseudoRandom(n ^ vector.length ^ 98765);$/", "language": "TypeScript", "kind": "property", "scope": "SimpleHNSWIndex", "scopeKind": "class"}, {"_type": "tag", "name": "rnd", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^    const rnd = pseudoRandom(n ^ this.dims ^ 1234567);$/", "language": "TypeScript", "kind": "constant", "scope": "SimpleHNSWIndex.build", "scopeKind": "method"}, {"_type": "tag", "name": "s", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^    for (let s = 0; s < starts; s++) {$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "sc", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^          const sc = scores[nb] ?? (scores[nb] = cosine(this.embeddings[nb], vector));$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "score", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^        let best = { idx: current, score: currentScore };$/", "language": "TypeScript", "kind": "variable"}, {"_type": "tag", "name": "scored", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^    const scored = Array.from(candidates).map((idx) => ({$/", "language": "TypeScript", "kind": "constant"}, {"_type": "tag", "name": "starts", "path": "/home/kavia/workspace/code-generation/ai-retrieval-assistant-1892-1901/ai-rag-lite/src/search/hnsw.ts", "pattern": "/^    const starts = Math.min(5, Math.max(1, Math.floor(n \\/ 200)));$/", "language": "TypeScript", "kind": "property", "scope": "SimpleHNSWIndex", "scopeKind": "class"}], "hash": "d0874356421f9c6224b03ba482c8eafb", "format-version": 4, "code-base-name": "frontend", "filename": "ai-rag-lite/src/search/hnsw.ts", "fields": [{"name": "let best = { idx: current, score: currentScore };", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private built = false;", "scope": "SimpleHNSWIndex", "scopeKind": "class", "description": "unavailable"}, {"name": "let current = Math.floor(rand() * n);", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private dims = 0;", "scope": "SimpleHNSWIndex", "scopeKind": "class", "description": "unavailable"}, {"name": "private embeddings: number[][] = [];", "scope": "SimpleHNSWIndex", "scopeKind": "class", "description": "unavailable"}, {"name": "let improved = true;", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "private maxNeighbors: number;", "scope": "SimpleHNSWIndex", "scopeKind": "class", "description": "unavailable"}, {"name": "private nodes: Node[] = [];", "scope": "SimpleHNSWIndex", "scopeKind": "class", "description": "unavailable"}, {"name": "const rand = pseudoRandom(n ^ vector.length ^ 98765);", "scope": "SimpleHNSWIndex", "scopeKind": "class", "description": "unavailable"}, {"name": "for (let s = 0; s < starts; s++) {", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "const starts = Math.min(5, Math.max(1, Math.floor(n \\/ 200)));", "scope": "SimpleHNSWIndex", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"33": ""}]}